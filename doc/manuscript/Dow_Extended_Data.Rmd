---
title: ""
author:
output: 
  pdf_document:
    fig_caption: yes
    #toc: true # table of content true
    #toc_depth: 2  
header-includes:  \usepackage{float}
                  \usepackage{caption}
                  \captionsetup[table]{font=footnotesize}
                  \captionsetup[figure]{font=footnotesize}
                  \captionsetup[figure]{labelformat=empty}
                  \captionsetup[table]{labelformat=empty}
                  \usepackage{pdflscape}
                  \newcommand{\blandscape}{\begin{landscape}}
                  \newcommand{\elandscape}{\end{landscape}}
---
```{r eval = TRUE, echo=FALSE, warning=FALSE, results='hide'}
path_to_results <- paste0(dirname(dirname(getwd())), "/results/") #I was trying to read directly from results folder, but couldn't get it working.

# EXTENDED DATA 
##tables
EDT_species="Extended Data Table 1"  
EDT_mean_growth_parameters="Extended Data Table 2" 
EDT_tree_ring_summary="Extended Data Table 3" 

sample_size_by_year= "XX"
#chronologies_table="S4" #!!! Hand-numbered in tree-ring figure captions

##figures
EDF_map = "Extended Data Figure 1" 
EDF_growth_curves_all = "Extended Data Figure 2"  
EDF_climwin = "Extended Data Figure 3"
EDF_pheno_Tmax_climwin = "Extended Data Figure 4"
EDF_pheno_Tmax_AprilMay = "Extended Data Figure 5"
EDF_pheno_Tmin_AprilMay = "Extended Data Figure 6"
EDF_tree_rings_TMIN = "Extended Data Figure 7"

## table captions
species_table_caption <-"Extended Data Table 1 | Dominant ring- and diffuse-porous species at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest, along with sample sizes included in this analysis."
mean_growth_parameters_caption = "Extended Data Table 2 | Summary of parameters describing the phenology and rate of growth for ring- and diffuse- porous species at SCBI and Harvard Forest."
tree_ring_summary_caption =  "Extended Data Table 3 | Summary of tree-ring chronologies analyzed and number of significant (at p=0.05) positive or negative correlations to monthly $T_{max}$ in univariate and multivariate analyses." 

## figure captions

map_caption <- "**Extended Data Figure 1 | Map of sampling locations of tree-ring chronologies analyzed in this study.** Sites are colored by the xylem porosity type of species sampled: ring poroous (RP), diffuse porous (DP), or both. Sampling details are provided in **SI TBALE NAME**" #needs attention!!!

growth_curves_all_caption  <- " **Extended Data Figure 2 | Growth trajectories for ring- and diffuse-porous trees, as both relative and cumulative fractions of total annual growth.** Each line represents one year's growth for a given tree, fit with McMahon model. " #needs wordsmithing!!!

climwin_caption <- "**Extended Data Figure 3 | Landscapes of relationships between the day of year on which 25% of annual growth is achieved ($DOY_{25}$) and temperature in prior weeks for ring- and diffuse-porous trees at SCBI and Harvard Forest.** Shown are matrices of linear coefficients of first-order linear regressions between temperature and $DOY_{25}$, where Window Open and Window Close indicate number of weeks prior to $DOY_{25}$ (ring-porous: May 5 at SCBI, May 13 at HF; diffuse-porous: June 4 at SCBI, June 14 at HF). Black circles indicate the critical $T_{max}$ window (ring-porous:  March 22- April 9 at SCBI, April 2 - May 07 at HF; diffuse-porous: Feb. 19- May 21 at SCBI, March 19 - May 07 at HF)." #info subject to change!!!

pheno_Tmax_climwin_caption <- "**Extended Data Figure 4 | Response of the timing of stem growth phenology to spring temperatures.** The days of year on which 25%, 50% and 75% of annual growth were acheived ($DOY_{25}$, $DOY_{50}$, and $DOY_{75}$, respectively) declined significantly with mean $T_{max}$ during their respective critical temperature window (CTW). For each CTW $T_{max}$, the posterior mean of the fitted day of year is represented by the solid line and 95% credible intervals are represented by bands. (**[FIGURE NEEDS SOME WORK/ MORE INFO](https://github.com/EcoClimLab/growth_phenology/issues/59). CAPTION NEEDS MORE DETAIL**)" #needs attention!!!

pheno_Tmax_AprilMay_caption <- "**Extended Data Figure 5 | Relationship between growth parameters and mean maximum temperature in April (SCBI) or May (HF).** For each observed climwin mean temperature value, the posterior mean of the fitted day of year is represented by the solid blue line and 95% credible intervals are represented by bands.(**[FIGURE NEEDS SOME WORK/ MORE INFO](https://github.com/EcoClimLab/growth_phenology/issues/59). CAPTION NEEDS MORE DETAIL**)" #needs attention!!!

pheno_Tmin_AprilMay_caption <- "**Extended Data Figure 6 | Relationship between growth parameters and mean minimum temperature in April (SCBI) or May (HF).** For each observed climwin mean temperature value, the posterior mean of the fitted day of year is represented by the solid blue line and 95% credible intervals are represented by bands.(**[FIGURE NEEDS SOME WORK/ MORE INFO](https://github.com/EcoClimLab/growth_phenology/issues/59). CAPTION NEEDS MORE DETAIL**)" #needs attention!!!

tree_rings_TMIN_caption <- "Extended Data Figure 7 | Sensitivity of annual growth, as derived from tree-rings, to monthly minimum temperatures, for 207 chronologies from 114 sites across eastern North America (Extended Data Figure 1). Chronologies are grouped by xylem porosity and ordered by mean April T_max. Chronology details are given in the Supplementary Information. (**NOTE: Figure still needs some work. Chronology numbers are off.**  See [GitHub Issue #49](https://github.com/EcoClimLab/growth_phenology/issues/49).)" #needs attention!!! #info subject to change!!!


```


\newpage

```{r species_table, eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
species_table <- read.csv(file = "tables_figures/species_table.csv", col.names = c("site", "xylem porosity","species", "species code", "n trees", "n tree-years", "n cores", "date range"),  stringsAsFactors = FALSE, check.names = FALSE)
kable(species_table, caption = species_table_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" ", " ", " ", " ", "dendrometer bands" = 2, "tree cores"=2 )) %>%
  pack_rows("", 1, 9, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 10, 11, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 12, 14, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 15, 22, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```

\newpage

```{r mean_growth_parameters_table,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
mean_growth_parameters <- read.csv("tables_figures/mean_growth_parameters.csv",  col.names = c("", "ring","diffuse","ring", "diffuse"), stringsAsFactors = FALSE, check.names = FALSE)
kable(mean_growth_parameters, caption = mean_growth_parameters_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" ",  "SCBI" = 2, "Harvard Forest"=2 )) %>%
    column_spec(1, width = "4cm") %>%
     pack_rows("Stem Growth", 1, 8, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    pack_rows("Leaf Phenology (ecosystem level)", 9, 12, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    #add_indent(9:12)
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```

\newpage

```{r tree_ring_summary,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
TreeRingResultsSummary <- read.csv("tables_figures/TreeRingResultsSummary.csv",  
                                   stringsAsFactors = FALSE, check.names = FALSE)
TreeRingResultsSummary <- TreeRingResultsSummary[c(2:17)]
kable(TreeRingResultsSummary, 
      caption = tree_ring_summary_caption,  
      col.names = c("species","n","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-"), 
      format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" " = 2,  "April" = 2, "May" = 2,"June" = 2,"July" = 2,"Aug" = 2,"April" = 2,"June-July" = 2)) %>%
add_header_above(c(" " = 2,  "univariate analysis" = 10,"multivariate analysis" = 4)) %>%
add_header_above(c(" " = 2,  "n. correlations significant at p=0.05" = 14)) %>%
    #column_spec(3:18, width = ".3cm") %>%
pack_rows("Ring Porous", 1, 16, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
pack_rows("Diffuse Porous", 17, 26, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
row_spec(27, bold = T) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```


\newpage


![`r map_caption`](tables_figures/chronology_map.png)


\newpage

![`r growth_curves_all_caption`](tables_figures/growth_curves_all.png){ width=100% }

\newpage

![`r climwin_caption`](tables_figures/climwin_figure.png){ width=70% }


\newpage

![`r pheno_Tmax_climwin_caption`](tables_figures/pheno_Tsensitivity_combo_patchwork_AIC.png){ width=90% }

\newpage

![`r pheno_Tmax_AprilMay_caption`](tables_figures/pheno_Tsensitivity_combo_patchwork_april_may.png){ width=90% }

\newpage

![`r pheno_Tmin_AprilMay_caption`](tables_figures/pheno_Tsensitivity_combo_patchwork_april_may_tmin.png){ width=90% }

\newpage

![`r tree_rings_TMIN_caption`](tables_figures/tree_rings_tmin.png){ width=90% } 
