---
title: ""
author:
output: 
  pdf_document:
    fig_caption: yes
    #toc: true # table of content true
    #toc_depth: 2  
header-includes:  \usepackage{float}
                  \usepackage{caption}
                  \captionsetup[table]{font=footnotesize}
                  \captionsetup[figure]{font=footnotesize}
                  \captionsetup[figure]{labelformat=empty}
                  \captionsetup[table]{labelformat=empty}
                  \usepackage{pdflscape}
                  \newcommand{\blandscape}{\begin{landscape}}
                  \newcommand{\elandscape}{\end{landscape}}
---
```{r eval = TRUE, echo=FALSE, warning=FALSE, results='hide'}
path_to_results <- paste0(dirname(dirname(getwd())), "/results/") #I was trying to read directly from results folder, but couldn't get it working.

# EXTENDED DATA 
##tables
EDT_species="Extended Data Table 1"  
EDT_phenology_parameters="Extended Data Table 2" 
EDT_tree_ring_summary="Extended Data Table 3" 

sample_size_by_year= "XX"
#chronologies_table="S4" #!!! Hand-numbered in tree-ring figure captions

##figures
EDF_map = "Extended Data Figure 1" 
EDF_growth_curves_all = "Extended Data Figure 2"  
EDF_climwin = "Extended Data Figure 3"
EDF_pheno_all = "Extended Data Figures 4-5"
EDF_pheno_Tmax_climwin = "Extended Data Figure 4"
EDF_pheno_Tmax_AprilMay = "Extended Data Figure 5"
EDF_tree_ring_figs= "Extended Data Figure 6-7"
EDF_tree_rings_TMIN = "Extended Data Figure 6"
EDF_tree_rings_TMAX_extended = "Extended Data Figure 7"

# Supplementary info
chron_table= "SI Table 1"

## table captions
species_table_caption <-"Extended Data Table 1 | Dominant ring- and diffuse-porous species at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest, along with sample sizes included in this analysis."
mean_growth_parameters_caption = "Extended Data Table 2 | Summary of parameters describing the phenology and temperature senisitivity of ring- and diffuse- porous species groups at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest."
tree_ring_summary_caption =  "Extended Data Table 3 | Summary of tree-ring chronologies analyzed and number of significant (at p=0.05) positive or negative correlations of ring width index to monthly $T_{max}$ in univariate and multivariate analyses." 


```


\newpage

```{r species_table, eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
species_table <- read.csv(file = "tables_figures/species_table.csv", col.names = c("site", " ","species", "species code", "n trees", "n tree-years", "n cores", "date range"),  stringsAsFactors = FALSE, check.names = FALSE) 
species_table <- species_table[c(2:3, 5:8)] #subset(species_table, select = -c(Species code) )#remove columns that shouldn't be included

kable(species_table, caption = species_table_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c( " ", " ", "dendrometer bands" = 2, "tree cores"=2 )) %>%
  pack_rows("SCBI", 1, 10, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 11, 12, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("Harvard Forest", 13, 15, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 16, 23, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```

\newpage

```{r mean_growth_parameters_table,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
mean_growth_parameters <- read.csv("tables_figures/phenology_parameters.csv",  col.names = c("", "ring-porous","diffuse-porous","ring-porous", "diffuse-porous"), stringsAsFactors = FALSE, check.names = FALSE)
kable(mean_growth_parameters, caption = mean_growth_parameters_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" ",  "SCBI" = 2, "Harvard Forest"=2 )) %>%
    column_spec(1, width = "4cm") %>%
    pack_rows("Stem Growth", 2, 8, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    pack_rows("Canopy Foliage (ecosystem level)", 9, 12, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    pack_rows("Phenological temperature sensitivity* (days/Â°C)", 13, 22, latex_gap_space = "1em", colnum = 5, hline_before = FALSE) %>%
    add_indent(14:17)%>%
    add_indent(19:22)%>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```
*Phenological temperature sensitivity refers to the sensitivity of a parameter to the mean maximum temperature ($T_{max}$) during the critical temperature window (Fig. 1).

\newpage

```{r tree_ring_summary,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
TreeRingResultsSummary <- read.csv("tables_figures/TreeRingResultsSummary.csv",  
                                   stringsAsFactors = FALSE, check.names = FALSE)
TreeRingResultsSummary <- TreeRingResultsSummary[c(2:17)]
kable(TreeRingResultsSummary, 
      caption = tree_ring_summary_caption,  
      col.names = c("species","n","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-"), 
      format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" " = 2,  "April" = 2, "May" = 2,"June" = 2,"July" = 2,"Aug" = 2,"April" = 2,"June-July" = 2)) %>%
add_header_above(c(" " = 2,  "univariate analysis" = 10,"multivariate analysis" = 4)) %>%
add_header_above(c(" " = 2,  "n. correlations to monthly mean max. T significant at p=0.05" = 14)) %>%
    column_spec(3:18, width = ".4cm") %>%
pack_rows("Ring-porous", 1, 16, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
pack_rows("Diffuse-porous", 17, 26, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
row_spec(27, bold = T) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```


\newpage


![**Extended Data Figure 1 | Map of sampling locations of tree-ring chronologies analyzed in this study.** Sites are colored by the xylem porosity type of species sampled: ring poroous (RP), diffuse porous (DP), or both. Sampling details are provided in **SI TBALE NAME**](tables_figures/chronology_map.png)


\newpage

![**Extended Data Figure 2 | Phenological patterns of forest canopy greenness (top row) and stem growth of ring- and diffuse-porous trees, represented as both relative and cumulative fractions of total annual growth (middle and bottom rows, respectively), at our two focal study sites** In the top row, canopy greenness is characterized using the two band Enhanced Vegetation Index (EVI2) ..., with each line representing a year between 2000 and 2018. For stem growth, each line represents one year's growth for a given tree, fit with McMahon model.](tables_figures/growth_curves_all.png){ width=100% }

\newpage

![**Extended Data Figure 3 | Landscapes of relationships between the day of year on which 25% of annual growth is achieved ($DOY_{25}$) and temperature in prior weeks for ring- and diffuse-porous trees at SCBI and Harvard Forest.** Shown are matrices of linear coefficients of first-order linear regressions between temperature and $DOY_{25}$, where Window Open and Window Close indicate number of weeks prior to $DOY_{25}$ (ring-porous: May 5 at SCBI, May 13 at HF; diffuse-porous: June 4 at SCBI, June 14 at HF). Black circles indicate the critical $T_{max}$ window (ring-porous:  March 22- April 9 at SCBI, April 2 - May 07 at HF; diffuse-porous: Feb. 19- May 21 at SCBI, March 19 - May 07 at HF).](tables_figures/climwin_figure.png){ width=70% }


\newpage

![**Extended Data Figure 4 | Response of the timing of stem growth phenology to spring temperatures.** Relationships between critical temperature window (CTW) $T_max$ and 25%, 50%, and 75% total stem growth (first row), the length of the peak growing season ($L_pgs$; second row), maximum growth rate ($g_max$; third row), and total seasonal radial stem growth ($\Delta DBH$; fourth row) are shown. Posterior predictions of each variable that did not include zero are represented with solid lines, while those that do include zero use dotted lines. 95% credible intervals are represented by bands. The days of year on which 25%, 50% and 75% of annual growth were acheived ($DOY_{25}$, $DOY_{50}$, and $DOY_{75}$, respectively) declined significantly with mean $T_{max}$ during their respective CTW. For each CTW $T_{max}$. Modeled values from dendrometer band measurements are represented by dots.](tables_figures/pheno_Tsensitivity_combo_patchwork_AIC.png){ width=90% }

\newpage

![**Extended Data Figure 5 | Relationship between growth parameters and mean maximum temperature in April (SCBI) or May (HF). Relationships between critical temperature window (CTW) $T_max$ and 25%, 50%, and 75% total stem growth (first row), the length of the peak growing season ($L_pgs$; second row), maximum growth rate ($g_max$; third row), and total seasonal radial stem growth ($\Delta DBH$; fourth row) are shown. Posterior predictions of each variable that did not include zero are represented with solid lines, while those that do include zero use dotted lines. 95% credible intervals are represented by bands.](tables_figures/pheno_Tsensitivity_combo_patchwork_april.png){ width=90% }

\newpage

![Extended Data Figure 6 | Sensitivity of annual growth, as derived from tree-rings, to monthly minimum temperatures of the current year for 208 chronologies from 114 sites across eastern North America (Extended Data Figure 1). Chronologies are grouped by xylem porosity and ordered by mean April T_max. Chronology details are given in `r chron_table`.](tables_figures/tree_rings_tmin.png){ width=90% } 

\newpage

![Extended Data Figure 7 | Sensitivity of annual growth, as derived from tree-rings, to monthly maximum temperatures of the current and past year for 208 chronologies from 114 sites across eastern North America (Extended Data Figure 1). Chronologies are grouped by xylem porosity and ordered by mean April T_max. Chronology details are given in `r chron_table`.](tables_figures/tree_rings_tmax_extended.png){ width=90% } 
