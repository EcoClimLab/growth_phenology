---
title: ""
author:
output: 
  pdf_document:
    fig_caption: yes
    #toc: true # table of content true
    #toc_depth: 2  
header-includes:  \usepackage{float}
                  \usepackage{caption}
                  \captionsetup[figure]{labelformat=empty}
                  \captionsetup[table]{labelformat=empty}
---
```{r eval = TRUE, echo=FALSE, warning=FALSE, results='hide'}
path_to_results <- paste0(dirname(dirname(getwd())), "/results/") #I was trying to read directly from results folder, but couldn't get it working.

# EXTENDED DATA 
##tables
EDT_species="Extended Data Table 1"  
EDT_phenology_parameters="Extended Data Table 2" 
EDT_tree_ring_summary="Extended Data Table 3" 

sample_size_by_year= "XX"
#chronologies_table="S4" #!!! Hand-numbered in tree-ring figure captions

##figures
EDF_map = "Extended Data Figure 1" 
EDF_growth_curves_all = "Extended Data Figure 2"  
EDF_climwin = "Extended Data Figure 3"
EDF_pheno_all = "Extended Data Figures 4-5"
EDF_pheno_Tmax_climwin = "Extended Data Figure 4"
EDF_pheno_Tmax_AprilMay = "Extended Data Figure 5"
EDF_tree_ring_figs= "Extended Data Figure 6-7"
EDF_tree_rings_TMIN = "Extended Data Figure 6"
EDF_tree_rings_TMAX_extended = "Extended Data Figure 7"

# Supplementary info
chron_table= "SI Table 1"

## table captions
species_table_caption <-"Extended Data Table 1 | Dominant ring- and diffuse-porous species at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest, along with sample sizes included in this analysis."
mean_growth_parameters_caption = "Extended Data Table 2 | Summary of parameters describing the seasonality and temperature senisitivity of ring- and diffuse- porous species groups at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest."
tree_ring_summary_caption =  "Extended Data Table 3 | Summary of tree-ring chronologies analyzed and number of significant (at p=0.05) positive or negative correlations of ring width index to monthly $T_{max}$ in univariate and multivariate analyses." 


###~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
## some stats/ 
chronology_table <- read.csv(file = "tables_figures/chronology_table.csv")
n_chronologies <- nrow(chronology_table)  
n_cores_sites <- length(unique(chronology_table[, "Location"]))
n_cores_species <- length(unique(chronology_table[, "Species"]))

```



\newpage

```{r species_table, eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
species_table <- read.csv(file = "tables_figures/species_table.csv", col.names = c("site", " ","species", "species code", "n trees", "n tree-years", "n cores", "date range"),  stringsAsFactors = FALSE, check.names = FALSE) 
species_table <- species_table[c(2:3, 5:8)] #subset(species_table, select = -c(Species code) )#remove columns that shouldn't be included

kable(species_table, caption = species_table_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c( " ", " ", "dendrometer bands" = 2, "tree cores"=2 )) %>%
  pack_rows("SCBI", 1, 10, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 11, 12, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("Harvard Forest", 13, 15, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
  pack_rows("", 16, 23, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```

\newpage

```{r mean_growth_parameters_table,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
mean_growth_parameters <- read.csv("tables_figures/phenology_parameters.csv",  col.names = c("", "ring-porous","diffuse-porous","ring-porous", "diffuse-porous"), stringsAsFactors = FALSE, check.names = FALSE)
kable(mean_growth_parameters, caption = mean_growth_parameters_caption ,  format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" ",  "SCBI" = 2, "Harvard Forest"=2 )) %>%
    column_spec(1, width = "4cm") %>%
    pack_rows("Stem Growth", 2, 7, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    pack_rows("Canopy Foliage (ecosystem level)", 8, 11, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
    pack_rows("Temperature sensitivity* (days/Â°C)", 12, 20, latex_gap_space = "1em", colnum = 5, hline_before = FALSE) %>%
    add_indent(13:16)%>%
    add_indent(18:21)%>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```
*Temperature sensitivity refers to the sensitivity of a parameter to the mean maximum temperature ($T_{max}$) during the critical temperature window (Fig. 1). Because leaf phenology measurements were derived from satellite imagery and included both ring- and diffuse-porous trees, the selection of a critical window was less straightforward. We used the critical window which had the greatest correlation with leaf greenup timing as the critical window for leaf phenology calculations.

\newpage

```{r tree_ring_summary,  eval=TRUE, echo=FALSE, warning=FALSE}
library(knitr)
library(kableExtra)
TreeRingResultsSummary <- read.csv("tables_figures/TreeRingResultsSummary.csv",  
                                   stringsAsFactors = FALSE, check.names = FALSE)
TreeRingResultsSummary <- TreeRingResultsSummary[c(2:17)]
kable(TreeRingResultsSummary, 
      caption = tree_ring_summary_caption,  
      col.names = c("species","n","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-","+", "-"), 
      format = "latex", booktabs = TRUE,  escape = F) %>%
add_header_above(c(" " = 2,  "April" = 2, "May" = 2,"June" = 2,"July" = 2,"Aug" = 2,"April" = 2,"June-July" = 2)) %>%
add_header_above(c(" " = 2,  "univariate analysis" = 10,"multivariate analysis" = 4)) %>%
add_header_above(c(" " = 2,  "n. correlations to monthly mean max. T significant at p=0.05" = 14)) %>%
    column_spec(3:18, width = ".4cm") %>%
pack_rows("Ring-porous", 1, 16, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
pack_rows("Diffuse-porous", 17, 26, latex_gap_space = "1em", colnum = 4, hline_before = FALSE) %>%
row_spec(27, bold = T) %>%
kable_styling(latex_options = c("scale_down", "hold_position"), protect_latex = T) 
```


\newpage


![**Extended Data Figure 1 | Map of sampling locations of tree-ring chronologies analyzed in this study.** Sites are colored by the xylem porosity type of species sampled: ring poroous (RP), diffuse porous (DP), or both. Sampling details are provided in `r chron_table`.](tables_figures/chronology_map.png)


\newpage

![**Extended Data Figure 2 | Phenological patterns of forest canopy greenness (top row) and stem growth of ring- and diffuse-porous trees, represented as both relative and cumulative fractions of total annual growth (middle and bottom rows, respectively), at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest.** In the top row, canopy greenness is characterized using the two band Enhanced Vegetation Index (EVI2), with each line representing a year between 2000 and 2018. For stem growth, each line represents the growth of one tree over one year, as modeled based on a five-parameter logistic growth model to dendrometer band data.](tables_figures/growth_curves_all.png){ width=100% }

\newpage

![**Extended Data Figure 3 | Landscapes of relationships between the day of year on which 25% of annual growth is achieved ($DOY_{25}$) and temperature in prior weeks for ring- and diffuse-porous trees at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest.** Shown are matrices of $\beta$ coefficients from first-order linear regressions between mean maximum temperature ($T_{max}$) and $DOY_{25}$. Window Open and Window Close indicate number of weeks prior to $DOY_{25}$ (listed in `r EDT_phenology_parameters`). Yellow shading indicates neutral relationships, while orange or red shading indicates that $DOY_{25}$ advances with increased $T_{max}$ over the given time window (negative $\beta$). Black circles indicate the critical temperature window selected based on minimization of $\Delta AICc$, the difference in Akaike Information Criterion corrected for small sample size relative to a null model. Critical temperature windows are listed in `r EDT_phenology_parameters`.](tables_figures/climwin_figure.png){ width=70% }


\newpage

![**Extended Data Figure 4 | Response of stem growth timing and rates to mean maximum temperatures ($T_{max}$) during the spring critial temperature window (CTW) for ring- and diffuse-porous speces at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest.** CTW was defined as the period over which $T_{max}$ was most strongly correlated with the day of year on which 25% of annual growth was achieved ($DOY_{25}$; `r EDT_phenology_parameters`, `r EDF_climwin`). Shown are relationships between mean $T_{max}$ over the CTW and days of the year on which 25%, 50%, and 75% total stem growth were achieved ($DOY_{25}$, $DOY_{50}$, $DOY_{75}$, respectively; first row); the length of the peak growing season ($L_{pgs}$; second row); maximum growth rate ($g_{max}$; third row); and total seasonal radial stem growth ($\Delta DBH$; fourth row). Posterior predictions of each variable that did not include zero are represented with solid lines, while those that do include zero use dotted lines. 95% credible intervals are represented by bands. For both species groups at both sites, $DOY_{25}$, $DOY_{50}$, and $DOY_{75}$ all declined significantly with mean $T_{max}$ during their respective CTW. Dots represent growth parameter values for individual tree-year combinations, which were derived by fitting a five-parameter logistic growth model to dendrometer band data.](tables_figures/pheno_Tsensitivity_combo_patchwork_AIC.png){ width=90% }

\newpage

![**Extended Data Figure 5 | Response of stem growth timing and rates to April mean maximum temperature ($T_{max}$) for ring- and diffuse-porous speces at the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest.** Shown are relationships between April $T_{max}$ and days of the year on which 25%, 50%, and 75% total stem growth were achieved ($DOY_{25}$, $DOY_{50}$, $DOY_{75}$, respectively; first row); the length of the peak growing season ($L_{pgs}$; second row); maximum growth rate ($g_{max}$; third row); and total seasonal radial stem growth ($\Delta DBH$; fourth row). Posterior predictions of each variable that did not include zero are represented with solid lines, while those that do include zero use dotted lines. 95% credible intervals are represented by bands. For both species groups at both sites, $DOY_{25}$, $DOY_{50}$, and $DOY_{75}$ declined significantly with April $T_{max}$, with the exception of $DOY_{25}$ for ring-porous species at SCBI. Dots represent growth parameter values for individual tree-year combinations, which were derived by fitting a five-parameter logistic growth model to dendrometer band data.](tables_figures/pheno_Tsensitivity_combo_patchwork_april.png){ width=90% }

\newpage

![**Extended Data Figure 6 | Sensitivity of annual growth, as derived from tree-rings, to monthly mean minimum temperatures ($T_{min}$), for `r n_chronologies` chronologies from `r n_cores_sites` sites across eastern North America** (`r EDF_map `). Colors indicate the correlation between monthly $T_{min}$ and a dimensionless ring width index (RWI) derived from the multiple trees that form each chronology and emphasizing interannual variability associated with climate. Chronologies are grouped by xylem porosity and ordered by mean April $T_{min}$. Plots are annotated to highlight records from our two focal sites, the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest (HF) (`r EDT_species`). Species analyzed and numbers of significant correlations to $T_{min}$ are summarized in `r EDT_tree_ring_summary`, and chronology details are given in `r chron_table`.](tables_figures/tree_rings_tmin.png){ width=100% } 

\newpage

![**Extended Data Figure 7 | Sensitivity of annual growth, as derived from tree-rings, to monthly mean maximum temperatures ($T_{max}$) of the current and past year, for `r n_chronologies` chronologies from `r n_cores_sites` sites across eastern North America** (`r EDF_map `). Colors indicate the correlation between monthly $T_{max}$ and a dimensionless ring width index (RWI) derived from the multiple trees that form each chronology and emphasizing interannual variability associated with climate. Chronologies are grouped by xylem porosity and ordered by mean April $T_{max}$. Plots are annotated to highlight records from our two focal sites, the Smithsonian Conservation Biology Institute (SCBI) and Harvard Forest (HF) (`r EDT_species`). Figure presents the same results as main manuscript Fig. 3 but extends back to include the previous year. Species analyzed and numbers of significant correlations to $T_{max}$ are summarized in `r EDT_tree_ring_summary`, and chronology details are given in `r chron_table`.](tables_figures/tree_rings_tmax_extended.png){ width=100% } 
